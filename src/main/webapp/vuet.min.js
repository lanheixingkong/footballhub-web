!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vuet=t.Vuet||{})}(this,function(t){"use strict";function e(t){return!(!0===t.window&&!t.self)}function n(t){return!!t.window}function r(t){r.installed||(r.installed=!0,g=t,Object.defineProperty(t.prototype,"$vuet",{get:function(){return this.$root._vuet}}),t.mixin({beforeCreate:function(){p.isUndefined(this.$options.vuet)||(this._vuet=this.$options.vuet,this._vuet._init(this))},destroyed:function(){p.isUndefined(this.$options.vuet)||(this._vuet=this.$options.vuet,this._vuet.destroy(this))}}),t.directive("vuet-scroll",b))}function o(t,e){var n=t._options.modules[e].manuals,r=void 0===n?{}:n,i={};return Object.keys(r).forEach(function(n){var o=r[n];"function"==typeof o&&(i[""+n]=function(){for(var n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];return o.apply(i,[{state:t.getState(e),app:t.app,vuet:t}].concat(r))})}),i.reset=function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.reset.apply(t,[e].concat(r))},i.getState=function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.getState.apply(t,[e].concat(r))},i.setState=function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.setState.apply(t,[e].concat(r))},i.fetch=function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.fetch.apply(t,[e].concat(r))},i.data=function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.data.apply(t,[e].concat(r))},i.mapManuals=function(e){return o(t,e)},i}function i(t,e){e.rule("life",$).rule("manual",w).rule("need",k).rule("once",O).rule("route",j)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},l=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},h=Object.prototype.toString,f=["Object","Function","String","Undefined","Null"],p={getArgMerge:function(){var t={},e=arguments;return p.isString(e[0])?t[e[0]]=e.length>1?e[1]:e[0]:e[0]&&p.isObject(e[0])&&(t=e[0]),t},set:function(t,e,n){Object.defineProperty(t,e,{value:n,enumerable:!1,writable:!0,configurable:!1})},isPromise:function(t){return!!t&&("object"===(void 0===t?"undefined":s(t))||"function"==typeof t)&&"function"==typeof t.then}};f.forEach(function(t){var e="[object "+t+"]";p["is"+t]=function(t){return h.call(t)===e}});var v={error:function(t){throw new Error("[vuet] "+t)},warn:function(t){},assertPath:function(t,e){e in t.store||this.error("The module does not exist. Call the this.$vuet method in the Vue component to see all module paths")}},d="__vuetScrollSelf__",y="__vuetScrollWindow__",m=function(){function t(e){u(this,t),this.timer={},this.setOption(e),this.scrollTo(),this.subScroll()}return a(t,[{key:"update",value:function(t){var e=this;this.setOption(t);var n="timer-"+this.path+"-"+this.name;clearTimeout(this.timer[n]),this.timer[n]=setTimeout(function(){e.scrollTo(),delete e.timer[n]},10)}},{key:"destroy",value:function(){this.app.removeEventListener("scroll",this.subScrolling,!1)}},{key:"setOption",value:function(t){this.app=t.app,this.path=t.path,this.name=t.name||"",this.store=t.store||{x:0,y:0},this.scrolls=t.scrolls||function(t){return t.store.$scroll||g.set(t.store,"$scroll",{}),t.store.$scroll[t.name]||g.set(t.store.$scroll,t.name,{x:0,y:0}),t.store.$scroll[t.name]}(t)}},{key:"scrollTo",value:function(){var t=this.app,e=this.scrolls;"scrollTop"in t&&t!==window?(t.scrollLeft=e.x,t.scrollTop=e.y):t.scrollTo(e.x,e.y)}},{key:"subScroll",value:function(){var t=this,e=this.app,n={x:0,y:0};this.subScrolling=function(r){if(e===window)n.x=window.pageXOffset,n.y=window.pageYOffset;else{var o=r.target,i=o.scrollTop,s=o.scrollLeft,u=o.pageXOffset,a=o.pageYOffset;n.x=s||a||s,n.y=i||u||i}Object.assign(t.scrolls,n)},e.addEventListener("scroll",this.subScrolling,!1)}}]),t}(),b={inserted:function(t,r,o){var i=r.modifiers,s=r.value;if("string"!=typeof s.path)return v.error("path is imperative parameter and is string type");if("window"===s.path)return v.error("name cannot be the window name");if(e(i)){if("string"!=typeof s.name)return v.error("name is imperative parameter and is string type");t[d]=new m({app:t,path:s.path,name:s.name,store:o.context.$vuet.store[s.path],scrolls:s.self})}n(i)&&(t[y]=new m({app:window,path:s.path,name:"window",store:o.context.$vuet.store[s.path],scrolls:s.window}))},componentUpdated:function(t,r,o){var i=r.modifiers,s=r.value;e(i)&&t[d].update({app:t,path:s.path,name:s.name,store:o.context.$vuet.store[s.path],scrolls:s.self}),n(i)&&t[y].update({app:window,path:s.path,name:"window",store:o.context.$vuet.store[s.path],scrolls:s.window||null})},unbind:function(t,r){var o=r.modifiers;e(o)&&(t[d].destroy(),delete t[d]),n(o)&&(t[y].destroy(),delete t[y])}},g=null,$={rule:function(t){var e=t.path;return{beforeCreate:function(){v.assertPath(this.$vuet,e),this.$vuet.fetch(e,{current:this})},destroyed:function(){this.$vuet.reset(e,{current:this})}}}},w={install:function(t,e){e.prototype.mapManuals=function(t){return o(this,t)}},rule:function(t){var e=t.path,n=t.name;return{beforeCreate:function(){v.assertPath(this.$vuet,e);var t=this.$vuet._options.modules[e].manuals,r=void 0===t?{}:t;this[n||r.name||"$"+this.$vuet.names[e]]=o(this.$vuet,e)}}}},k={rule:function(t){var e=t.path;return{beforeCreate:function(){v.assertPath(this.$vuet,e),this.$vuet.fetch(e,{current:this})}}}},_="__once__",O={init:function(t){p.set(t,_,{}),Object.keys(t.store).forEach(function(e){p.set(t[_],e,!1)})},rule:function(t){var e=t.path;return{beforeCreate:function(){var t=this;v.assertPath(this.$vuet,e),!1===this.$vuet[_][e]&&this.$vuet.fetch(e,{current:this}).then(function(){t.$vuet[_][e]=!0})}}}},S="__route__",j={init:function(t){p.set(t,S,{watchers:{},scrolls:{}}),Object.keys(t.store).forEach(function(e){p.set(t[S].watchers,e,[]),p.set(t[S].scrolls,e,{})})},rule:function(t){function e(t){var e=t.$vuet.store[s].$scroll;e&&Object.keys(e).forEach(function(t){e[t].x=0,e[t].y=0,e[t].count=e[t].count?++e[t].count:0})}function n(t){return t[S].watchers[s]}function r(t,e){t[S].watchers[s]=e}function o(t,e){"string"==typeof e&&(e=[e]);var n=function(t,e){var n=t;return e.split(".").forEach(function(t){n=n[t]}),n},r=[];return e.forEach(function(e){var o=n(t,e);isNaN(o)||(o=String(o)),r.push(JSON.stringify(o))}),r}function i(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!0;return!1}var s=t.path;return{beforeCreate:function(){var t=this;v.assertPath(this.$vuet,s);var u=this.$vuet._options.modules[s].routeWatch,a=void 0===u?"fullPath":u,c=o(this.$route,a),l=i(c,n(this.$vuet));l&&(this.$vuet.reset(s),r(this.$vuet,c),e(this)),this.$vuet.fetch(s,{current:this,routeWatch:l},!1).then(function(e){i(c,o(t.$route,a))||(t.$vuet.setState(s,e),r(t.$vuet,c))})},watch:{$route:{deep:!0,handler:function(t,n){var u=this,a=this.$vuet._options.modules[s].routeWatch,c=void 0===a?"fullPath":a,l=o(t,c),h=o(n,c),f=i(l,h);if(!f)return!1;this.$vuet.fetch(s,{current:this,routeWatch:f}).then(function(t){i(l,o(u.$route,c))||(e(u),u.$vuet.setState(s,t),r(u.$vuet,l))})}}}}}},P=function(){function t(e){u(this,t),g||v.error("must call Vue.use(Vuet) before creating a store instance"),"undefined"==typeof Promise&&v.error("Vuet requires a Promise polyfill in this browser"),p.isObject(e)||v.error("Parameter is the object type"),this.version="0.2.9",this.options=e||{},this.app=null,this.store={},this.names={},this.beforeHooks=[],this.afterHooks=[],this.vm=null}return a(t,null,[{key:"install",value:function(){r.apply(void 0,arguments)}},{key:"rule",value:function(e,n){return this.options.rules[e]?this:(this.options.rules[e]=n,p.isFunction(n.install)&&n.install(g,t),this)}},{key:"mapRules",value:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var o=p.getArgMerge.apply(null,arguments),i=[],s=function(e,n){var r=t.options.rules[e];"string"==typeof n?i.push(r.rule({path:n})):i.push(r.rule(n))};return Object.keys(o).forEach(function(t){var e=o[t];if(Array.isArray(e))return e.forEach(function(e){s(t,e)});s(t,e)}),{mixins:i}}},{key:"mapModules",value:function(){var t=p.getArgMerge.apply(null,arguments),e={};return Object.keys(t).forEach(function(n){var r=t[n];e[n]={get:function(){return v.assertPath(this.$vuet,r),this.$vuet.store[r]},set:function(t){v.assertPath(this.$vuet,r),this.$vuet.store[r]=t}}}),{computed:e}}},{key:"use",value:function(e,n){return p.isFunction(e)?e(g,t,n):p.isFunction(e.install)&&e.install(g,t,n),this}},{key:"callRuleHook",value:function(e,n){var r=t.options.rules;for(var o in r)p.isFunction(r[o][e])&&r[o][e](n)}}]),a(t,[{key:"beforeEach",value:function(t){return this.beforeHooks.push(t),this}},{key:"afterEach",value:function(t){return this.afterHooks.push(t),this}},{key:"_init",value:function(e){var n=this;if(!this.app&&e){this.app=e,this.vm=new g({data:{store:this.store}}),this._options=c({data:function(){return{}},pathJoin:null},this.options,{modules:{}});var r=["data","fetch","routeWatch","manuals"],o=this._options.pathJoin;!function t(e,i){Object.keys(i).forEach(function(s){var u=i[s],a=[].concat(l(e),[s]);if(p.isFunction(u.data)){var c=null;if(o)c=a.join(o);else{c=[a[0]];for(var h=1;h<a.length;h++)c.push(a[h].replace(/^(\w)/,function(t){return t.toUpperCase()}));c=c.join("")}n._options.modules[c]=u,n.reset(c),n.names[c]=s}-1===r.indexOf(s)&&p.isObject(u)&&t(a,u)})}([],this.options.modules),t.callRuleHook("init",this)}}},{key:"getState",value:function(t){return this.store[t]}},{key:"setState",value:function(t,e){return this.store[t]&&Object.prototype.toString.call(this.store[t])!==Object.prototype.toString.call(e)?this:this.store[t]&&p.isObject(e)?(Object.assign(this.store[t],e),this):(g.set(this.store,t,e),this)}},{key:"fetch",value:function(t,e,n){var r=this,o=this._options.modules[t];if("function"!=typeof o.fetch)return Promise.resolve(this.getState(t));var i={path:t,params:c({},e),state:this.getState(t),route:this.app.$route||{},app:this.app},s=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];for(var i=0;i<r[t].length;i++)if(r[t][i].apply(r,n))return!1};if(!1===s("beforeHooks",i))return Promise.resolve(i.state);var u=o.fetch.call(this,i);return p.isPromise(u)||v.error("The fetch method of the '"+t+"' module should return an Promise"),u.then(function(e){return!1===s("afterHooks",null,i,e)?i.state:!1===n?e:(r.setState(t,e),i.state)}).catch(function(t){return!1===s("afterHooks",t,i)?Promise.resolve(i.state):Promise.reject(t)})}},{key:"reset",value:function(t){var e=this._options.data.call(this),n=this._options.modules[t].data;if(p.isFunction(n)){var r=n.call(this,t);p.isObject(r)?(Object.assign(e,r),this.setState(t,e)):this.setState(t,r)}return this}},{key:"data",value:function(t){return p.isObject(this._options.modules[t])?this._options.modules[t].data.call(this):null}},{key:"destroy",value:function(){this.vm.$destroy(),t.callRuleHook("destroy",this)}}]),t}();P.options={rules:{}},P.use(i);var x=P.mapRules.bind(P),A=P.mapModules.bind(P);t.mapRules=x,t.mapModules=A,t.default=P,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=vuet.min.js.map
